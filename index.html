<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Reunion Form</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <style>
        /* Inter font for a clean, modern look */
        @import url('https://rsms.me/inter/inter.css');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        
        /* The main content container */
        .container {
            max-width: 1000px;
        }

        /* Floating summary bar */
        .cost-summary-bar {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4a5568; /* Darker gray background */
            color: #fff;
            padding: 1.5em;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            transition: all 0.3s ease-in-out;
            width: 300px;
            display: none; /* Initially hidden */
        }
        
        @media (max-width: 1024px) {
            .cost-summary-bar {
                position: static;
                width: 100%;
                margin-top: 2rem;
            }
        }
    
        /* Styles for the confirmation page */
        #confirmationPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #confirmationCard {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
        }

        /* Hide number input spinners */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Style for the excursion categories */
        .excursion-category {
            margin-bottom: 2rem;
        }

        /* Input with buttons */
        .number-input-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #fff;
            padding: 0.25rem;
        }
        .number-input-container button {
            width: 2rem;
            height: 2rem;
            color: #6b7280;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .number-input-container button:hover {
            background-color: #e5e7eb;
            border-radius: 0.25rem;
        }
        .number-input-container input {
            width: 100%;
            text-align: center;
            -moz-appearance: textfield;
            border: none;
            outline: none;
            background-color: transparent;
        }

        .section-divider {
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Confirmation Page Overlay (initially hidden) -->
    <div id="confirmationPage" class="fixed inset-0 bg-gray-50 flex items-center justify-center p-6 z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-2xl max-w-xl text-center transition-transform duration-500 transform scale-95 opacity-0" id="confirmationCard">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-green-500 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Form Submitted!</h1>
            <p class="text-gray-600 mb-4">Your family reunion form has been submitted successfully. Thank you!</p>
            <p class="text-sm font-semibold text-gray-500">Redirecting in <span id="countdown">5</span> seconds...</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div id="mainContent" class="py-12 px-6">
        <div class="container mx-auto flex flex-col lg:flex-row gap-8">
            
            <!-- Left Side: Form -->
            <div class="flex-grow">
                <!-- Header Section -->
                <div class="mb-8 text-center">
                    <h1 class="text-4xl font-bold mb-2">Table Rock Lake Family Reunion</h1>
                    <p class="text-lg text-gray-600">Please complete this form to help us plan!</p>
                </div>
                
                <form id="reunionForm" class="bg-white p-6 rounded-lg shadow-lg space-y-8">
                    
                    <!-- Family Information -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Family Information</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="familyName" class="block text-sm font-medium text-gray-700">Family Name</label>
                                <select id="familyName" name="familyName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select your family</option>
                                    <option value="Joe &amp; Kathy">Joe &amp; Kathy</option>
                                    <option value="Ryan">Ryan</option>
                                    <option value="Justin">Justin</option>
                                    <option value="Aubrey">Aubrey</option>
                                    <option value="Britney">Britney</option>
                                    <option value="Megan">Megan</option>
                                    <option value="Holly">Holly</option>
                                    <option value="Josh">Josh</option>
                                    <option value="Katie">Katie</option>
                                </select>
                            </div>
                            <div>
                                <label for="attendees" class="block text-sm font-medium text-gray-700">Who is attending? (Names & kids' ages)</label>
                                <textarea id="attendees" name="attendees" required rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Lodging Selection -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Lodging Selection</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="lodgingCost" class="block text-sm font-medium text-gray-700">What type of lodging will your family need?</label>
                                <select id="lodgingCost" name="lodgingCost" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select one</option>
                                    <option value="2129.63">Private bed only ‚Äî $2,129.63</option>
                                    <option value="2555.56">Bed + space for kids ‚Äî $2,555.56</option>
                                </select>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="extraBed" name="extraBed" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="extraBed" class="ml-2 block text-sm font-medium text-gray-700">Add an additional private bed ‚Äî $450</label>
                            </div>
                        </div>
                    </section>

                    <!-- Travel Information -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Travel Information</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="travelMode" class="block text-sm font-medium text-gray-700">How are you traveling?</label>
                                <select id="travelMode" name="travelMode" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select</option>
                                    <option value="flying">Flying ($400/person)</option>
                                    <option value="driving">Driving (mileage-based)</option>
                                </select>
                            </div>
                            <div id="travel-origin-group" class="hidden">
                                <label for="travelOrigin" class="block text-sm font-medium text-gray-700">Travel Origin</label>
                                <select id="travelOrigin" name="travelOrigin" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select</option>
                                    <!-- Data-distance attributes for driving calculation -->
                                    <option value="Pocatello, ID" data-distance="1350">Pocatello, ID (~1350 miles)</option>
                                    <option value="Idaho Falls, ID" data-distance="1363">Idaho Falls, ID (~1363 miles)</option>
                                    <option value="Denver, CO" data-distance="803">Denver, CO (~803 miles)</option>
                                    <option value="Peachtree City, GA" data-distance="640">Peachtree City, GA (~640 miles)</option>
                                    <option value="Salt Lake City, UT" data-distance="1286">Salt Lake City, UT (~1286 miles)</option>
                                    <option value="Springfield, MO" data-distance="44">Springfield, MO (~44 miles)</option>
                                </select>
                            </div>
                            <div id="mileage-details-group" class="hidden">
                                <p class="text-sm text-gray-600">Driving cost is calculated based on a round trip at 20 MPG and $3.00/gallon.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="adultTravelers" class="block text-sm font-medium text-gray-700">Adult Travelers</label>
                                    <input type="number" id="adultTravelers" name="adultTravelers" min="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                </div>
                                <div>
                                    <label for="childTravelers" class="block text-sm font-medium text-gray-700">Child Travelers</label>
                                    <input type="number" id="childTravelers" name="childTravelers" min="0" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                </div>
                            </div>
                            <div id="airport-group" class="hidden">
                                <label for="arrivalAirport" class="block text-sm font-medium text-gray-700">Arrival Airport</label>
                                <select id="arrivalAirport" name="arrivalAirport" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="Springfield">Springfield</option>
                                    <option value="Bentonville">Bentonville</option>
                                    <option value="Tulsa">Tulsa</option>
                                </select>
                            </div>
                        </div>
                    </section>
                    
                    <div class="section-divider"></div>

                    <!-- Meal Planning -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">üçΩÔ∏è Meal Planning</h2>
                        <p class="text-gray-600 mb-4">Select the meals your family will attend. The cost is calculated at $5 for breakfast, $6 for lunch, and $8 for dinner per adult, with half-price for children.</p>
                        <div id="meals-list" class="space-y-4">
                            <!-- Meals will be dynamically populated here -->
                        </div>
                    </section>

                    <div class="section-divider"></div>

                    <!-- Excursions -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Excursions</h2>
                        <p class="text-gray-600 mb-4">Select the number of participants for each activity. The cost is per person.</p>
                        
                        <!-- Adventure & Thrill Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üé¢ Adventure & Thrill</h3>
                            <div id="adventure-thrill-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Outdoors & Nature Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üèûÔ∏è Outdoors & Nature</h3>
                            <div id="nature-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Golf & Recreation Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">‚õ≥ Golf & Recreation</h3>
                            <div id="golf-recreation-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Shows & Entertainment Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üé≠ Shows & Entertainment</h3>
                            <div id="shows-entertainment-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Indoor Fun & Museums Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üß† Indoor Fun & Museums</h3>
                            <div id="indoor-fun-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Desserts & Treats Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üç¶ Desserts & Treats (Interest Only)</h3>
                            <p class="text-gray-600 mb-4 text-sm">Please check the box if you are interested in visiting these places.</p>
                            <div id="desserts-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                         <!-- Rentals Category -->
                         <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üö§ Rentals (Shared Cost Estimate)</h3>
                            <p class="text-gray-600 mb-4 text-sm">Prices shown are per person estimates.</p>
                            <div id="rentals-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Shopping & Free Time Category -->
                        <div class="excursion-category">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">üõçÔ∏è Shopping & Free Time</h3>
                            <p class="text-gray-600 mb-4 text-sm">Please check the box if you are interested in visiting these places.</p>
                            <div id="shopping-excursions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Excursion cards will be dynamically populated here -->
                            </div>
                        </div>

                    </section>

                    <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-md transition-colors duration-200 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                        Submit Form
                    </button>
                    <div id="messageBox" class="mt-4 p-3 bg-indigo-100 text-indigo-800 rounded-md hidden"></div>
                </form>
            </div>
            
            <!-- Right Side: Cost Summary Card -->
            <div class="lg:w-1/3">
                <div class="cost-summary-bar">
                    <h3 class="text-xl font-bold mb-4">Your Summary</h3>
                    <div id="detailedSummary" class="space-y-3">
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-gray-200">Lodging Cost:</span>
                            <span id="summary-lodging" class="font-semibold text-right">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-gray-200">Extra Bed:</span>
                            <span id="summary-extra-bed" class="font-semibold text-right">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-gray-200">Travel Cost:</span>
                            <span id="summary-travel" class="font-semibold text-right">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-gray-200">Meal Cost:</span>
                            <span id="summary-meals" class="font-semibold text-right">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-gray-200">Excursion Cost:</span>
                            <span id="summary-excursions" class="font-semibold text-right">$0.00</span>
                        </div>
                    </div>
                    <hr class="border-t border-gray-600 my-4">
                    <div class="flex justify-between items-center text-xl font-bold">
                        <span>Total:</span>
                        <span id="summary-total-cost">$0.00</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- JavaScript for dynamic calculations and form submission -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Form elements and containers
            const reunionForm = document.getElementById('reunionForm');
            const mainContent = document.getElementById('mainContent');
            const confirmationPage = document.getElementById('confirmationPage');
            const confirmationCard = document.getElementById('confirmationCard');
            const messageBox = document.getElementById('messageBox');
            const costSummaryBar = document.querySelector('.cost-summary-bar');

            // Form sections
            const lodgingCostSelect = document.getElementById('lodgingCost');
            const extraBedCheckbox = document.getElementById('extraBed');
            const travelModeSelect = document.getElementById('travelMode');
            const travelOriginSelect = document.getElementById('travelOrigin');
            const adultTravelersInput = document.getElementById('adultTravelers');
            const childTravelersInput = document.getElementById('childTravelers');
            const airportGroup = document.getElementById('airport-group');
            const travelOriginGroup = document.getElementById('travel-origin-group');
            const mileageDetailsGroup = document.getElementById('mileage-details-group');
            const mealsList = document.getElementById('meals-list');
            
            // New excursion containers
            const adventureThrillExcursionsContainer = document.getElementById('adventure-thrill-excursions');
            const natureExcursionsContainer = document.getElementById('nature-excursions');
            const golfRecreationExcursionsContainer = document.getElementById('golf-recreation-excursions');
            const showsEntertainmentExcursionsContainer = document.getElementById('shows-entertainment-excursions');
            const indoorFunExcursionsContainer = document.getElementById('indoor-fun-excursions');
            const dessertsExcursionsContainer = document.getElementById('desserts-excursions');
            const rentalsExcursionsContainer = document.getElementById('rentals-excursions');
            const shoppingExcursionsContainer = document.getElementById('shopping-excursions');

            // Summary elements
            const summaryLodging = document.getElementById('summary-lodging');
            const summaryExtraBed = document.getElementById('summary-extra-bed');
            const summaryTravel = document.getElementById('summary-travel');
            const summaryMeals = document.getElementById('summary-meals');
            const summaryExcursions = document.getElementById('summary-excursions');
            const summaryTotalCost = document.getElementById('summary-total-cost');
            
            // This is a placeholder URL and placeholder entry IDs.
            const googleFormUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSc5jB0nhVWjpjHoViUiEJqX7BBheodhDNge6Pzb12yhTrnG3Q/formResponse';
            const googleFormEntryIds = {
                familyName: 'entry.1111',
                attendees: 'entry.2222',
                lodgingCost: 'entry.3333',
                extraBed: 'entry.4444',
                travelMode: 'entry.5555',
                travelOrigin: 'entry.6666',
                arrivalAirport: 'entry.7777',
                adultTravelers: 'entry.8888',
                childTravelers: 'entry.9999',
                mileage: 'entry.1010',
                selectedMeals: 'entry.1112',
                selectedExcursions: 'entry.1113',
                totalCost: 'entry.1114',
                selectedInterestOnly: 'entry.1115'
            };

            const meals = [
                { id: "Sunday_Breakfast", name: "Sunday Breakfast", cost: { adult: 5, child: 2.5 } },
                { id: "Sunday_Lunch", name: "Sunday Lunch", cost: { adult: 6, child: 3 } },
                { id: "Sunday_Dinner", name: "Sunday Dinner", cost: { adult: 8, child: 4 } },
                { id: "Monday_Breakfast", name: "Monday Breakfast", cost: { adult: 5, child: 2.5 } },
                { id: "Monday_Lunch", name: "Monday Lunch", cost: { adult: 6, child: 3 } },
                { id: "Monday_Dinner", name: "Monday Dinner", cost: { adult: 8, child: 4 } },
                { id: "Tuesday_Breakfast", name: "Tuesday Breakfast", cost: { adult: 5, child: 2.5 } },
                { id: "Tuesday_Lunch", name: "Tuesday Lunch", cost: { adult: 6, child: 3 } },
                { id: "Tuesday_Dinner", name: "Tuesday Dinner", cost: { adult: 8, child: 4 } },
                { id: "Wednesday_Breakfast", name: "Wednesday Breakfast", cost: { adult: 5, child: 2.5 } },
                { id: "Wednesday_Lunch", name: "Wednesday Lunch", cost: { adult: 6, child: 3 } },
                { id: "Wednesday_Dinner", name: "Wednesday Dinner", cost: { adult: 8, child: 4 } },
            ];

            const excursions = [
                // Adventure & Thrill
                { category: 'adventure-thrill', id: "silverDollarCity", name: "Silver Dollar City", description: "A sprawling 1880s-style theme park with thrilling coasters, craft demonstrations, and live entertainment.", adultPrice: 89, childPrice: 79, url: "https://www.silverdollarcity.com" },
                { category: 'adventure-thrill', id: "bransonMountainCoaster", name: "Branson Mountain Coaster", description: "Race through the Ozark hills on a self-controlled alpine coaster with dips and turns through the woods.", adultPrice: 20, childPrice: 20, url: "https://bransonmountaincoaster.com" },
                { category: 'adventure-thrill', id: "wolfeMountainZipline", name: "Wolfe Mountain Zipline", description: "Soar through tree canopies on scenic ziplines and explore the Snowflex tubing hill in all seasons.", adultPrice: 130, childPrice: 130, url: "https://wolfemountainbranson.com" },
                { category: 'adventure-thrill', id: "fritzsAdventure", name: "Fritz‚Äôs Adventure", description: "Indoor adventure park with ropes courses, underground tunnels, climbing walls, and thrilling slides.", adultPrice: 35, childPrice: 35, url: "https://www.fritzsadventure.com" },
                { category: 'adventure-thrill', id: "shepherdHillsAdventurePark", name: "Shepherd of the Hills Adventure Park", description: "Classic Branson destination offering ziplines, ropes courses, and a historic outdoor drama.", adultPrice: 30, childPrice: 30, url: "https://www.shepherdofthehills.com" },
                { category: 'adventure-thrill', id: "bigfootFunPark", name: "Bigfoot Fun Park", description: "Family fun with thrill rides, arcade games, and themed Bigfoot attractions including a gravity bomb.", adultPrice: 25, childPrice: 25, url: "https://bigfootfunpark.com" },
                { category: 'adventure-thrill', id: "xtremeRacingCenter", name: "Xtreme Racing Center", description: "Go full throttle on high-speed karts built for racing on a professionally designed outdoor track.", adultPrice: 40, childPrice: 40, url: "https://xtremeracingcenter.com" },
                
                // Outdoors & Nature
                { category: 'nature', id: "dogwoodCanyonNaturePark", name: "Dogwood Canyon Nature Park", description: "Explore lush trails, waterfalls, and wildlife on foot or by tram through this 10,000-acre private preserve.", adultPrice: 20, childPrice: 12, url: "https://www.dogwoodcanyon.org" },
                { category: 'nature', id: "topOfTheRockGolfCartTour", name: "Top of the Rock Golf Cart Tour", description: "Drive through stunning canyons and caves on a self-guided cart tour with panoramic Ozark views.", adultPrice: 50, childPrice: 35, url: "https://topoftherock.com/activities/lost-canyon-cave-and-nature-trail/" },
                { category: 'nature', id: "tableRockLakeBoating", name: "Table Rock Lake & Boating", description: "Enjoy a relaxing day swimming, fishing, or boating on the crystal-clear waters of Table Rock Lake.", adultPrice: 10, childPrice: 10, url: "https://mostateparks.com/park/table-rock-state-park" },
                { category: 'nature', id: "ozarkMountainBiking", name: "Ozark Mountain Biking", description: "Tackle scenic mountain trails suited for all skill levels with bike rentals available on-site.", adultPrice: 20, childPrice: 20, url: null },
                { category: 'nature', id: "shepherdHillsPettingZoo", name: "Shepherd of the Hills Petting Zoo", description: "Feed goats, llamas, and other animals at this charming farm-themed experience for all ages.", adultPrice: 10, childPrice: 10, url: "https://www.shepherdofthehills.com/attractions/petting-zoo" },
                { category: 'nature', id: "henningConservationArea", name: "Henning Conservation Area", description: "Free scenic hiking trails through wooded Ozark hills and a historic fire tower overlook.", adultPrice: 0, childPrice: 0, url: "https://mdc.mo.gov/discover-nature/places/drury-m-henning-conservation-area" },
                { category: 'nature', id: "lakesideForestWildernessArea", name: "Lakeside Forest Wilderness Area", description: "Nature preserve with waterfalls, stone steps, and panoramic views of Lake Taneycomo.", adultPrice: 0, childPrice: 0, url: "https://www.bransonmo.gov/395/Lakeside-Forest-Wilderness-Area" },
                
                // Golf & Recreation
                { category: 'golf-recreation', id: "bigCedarLodgeGolf", name: "Big Cedar Lodge Golf", description: "Play on world-class courses like Payne‚Äôs Valley, with breathtaking views and professional-grade design.", adultPrice: 300, childPrice: 300, url: "https://bigcedar.com/golf" },
                { category: 'golf-recreation', id: "miniGolf", name: "Mini Golf", description: "Enjoy light-hearted competition at whimsical mini golf courses located across Branson.", adultPrice: 15, childPrice: 15, url: null },
                { category: 'golf-recreation', id: "bransonTracksArcade", name: "Branson Tracks & Arcade", description: "Fast-paced go-kart tracks, classic arcade games, and mini thrill rides for all ages.", adultPrice: 15, childPrice: 15, url: "https://bransontracks.com" },
                { category: 'golf-recreation', id: "familyBowlingNight", name: "Family Bowling Night", description: "Unwind with a family-friendly night at one of Branson‚Äôs retro or modern bowling alleys.", adultPrice: 25, childPrice: 25, url: null },
                
                // Shows & Entertainment
                { category: 'shows-entertainment', id: "dollyPartonStampede", name: "Dolly Parton‚Äôs Stampede", description: "A four-course dinner and action-packed show with horseback stunts, music, and patriotic flair.", adultPrice: 65, childPrice: 35, url: "https://dpstampede.com" },
                { category: 'shows-entertainment', id: "sightAndSoundTheatre", name: "Sight & Sound Theatre", description: "Epic Bible stories brought to life with Broadway-quality acting, animals, and massive sets.", adultPrice: 80, childPrice: 35, url: "https://www.sight-sound.com/shows/branson" },
                { category: 'shows-entertainment', id: "showboatBransonBelle", name: "Showboat Branson Belle", description: "Cruise Table Rock Lake with a three-course dinner and live music, comedy, and variety shows.", adultPrice: 70, childPrice: 40, url: "https://www.silverdollarcity.com/showboat-branson-belle" },
                { category: 'shows-entertainment', id: "imaxEntertainmentComplex", name: "IMAX Entertainment Complex", description: "Catch Hollywood films and live performances on one of the largest IMAX screens in the Midwest.", adultPrice: 20, childPrice: 20, url: "https://bransonimax.com" },
                { category: 'shows-entertainment', id: "rezaEdgeOfIllusion", name: "Reza: Edge of Illusion", description: "Mind-blowing magic and illusion in one of Branson‚Äôs most popular modern shows.", adultPrice: 45, childPrice: 25, url: "https://rezalive.com" },
                { category: 'shows-entertainment', id: "clayCooper", name: "Clay Cooper‚Äôs Country Express", description: "High-energy country, rock and comedy from Branson's hometown entertainer.", adultPrice: 40, childPrice: 20, url: "https://claycooper.com" },
                { category: 'shows-entertainment', id: "presleysCountryJubilee", name: "The Presley‚Äôs Country Jubilee", description: "Classic Ozarks comedy and country music performed by Branson‚Äôs first family of entertainment.", adultPrice: 42, childPrice: 20, url: "https://presleys.com" },
                { category: 'shows-entertainment', id: "hughesMusicShow", name: "The Hughes Music Show", description: "Big family production with music, dance, and light effects ‚Äî performed by the Hughes Brothers.", adultPrice: 38, childPrice: 18, url: "https://hughesmusicshow.com" },
                { category: 'shows-entertainment', id: "texasTenors", name: "The Texas Tenors", description: "America‚Äôs Got Talent favorites blend country, classical, and pop in a polished vocal performance.", adultPrice: 50, childPrice: 25, url: "https://thetexastenors.com" },
                { category: 'shows-entertainment', id: "haygoods", name: "The Haygoods", description: "High-energy music show featuring sibling performers, pyrotechnics, and modern harmonies.", adultPrice: 47, childPrice: 25, url: "https://thehaygoods.com" },
                { category: 'shows-entertainment', id: "duttons", name: "The Duttons", description: "Family of musicians performing country, bluegrass, and pop hits.", adultPrice: 43, childPrice: 22, url: "https://theduttons.com" },

                // Indoor Fun & Museums
                { category: 'indoor-fun', id: "wonderworks", name: "WonderWorks", description: "An upside-down science museum with over 100 hands-on exhibits, laser tag, and rope courses.", adultPrice: 35, childPrice: 20, url: "https://www.wonderworksonline.com/branson" },
                { category: 'indoor-fun', id: "aquariumAtTheBoardwalk", name: "Aquarium at the Boardwalk", description: "Dive into ocean life with touch tanks, a jellyfish room, and a 5D submarine ride.", adultPrice: 30, childPrice: 15, url: "https://www.aquariumattheboardwalk.com" },
                { category: 'indoor-fun', id: "titanicMuseum", name: "Titanic Museum", description: "Experience the tragedy and triumph of the Titanic through artifacts, replicas, and guided tours.", adultPrice: 35, childPrice: 20, url: "https://titanicbranson.com" },
                { category: 'indoor-fun', id: "butterflyPalace", name: "Butterfly Palace", description: "Stroll through a lush tropical garden filled with thousands of free-flying butterflies.", adultPrice: 25, childPrice: 15, url: "https://www.thebutterflypalace.com" },
                { category: 'indoor-fun', id: "ripleysBelieveItOrNot", name: "Ripley‚Äôs Believe It or Not!", description: "Weird, wacky, and unbelievable ‚Äî explore oddities from around the globe in themed galleries.", adultPrice: 25, childPrice: 15, url: "https://www.ripleys.com/branson" },
                { category: 'indoor-fun', id: "retroArcadeNight", name: "Retro Arcade Night", description: "Step into the '80s with classic arcade cabinets and unlimited play passes.", adultPrice: 20, childPrice: 20, url: null },
                { category: 'indoor-fun', id: "hollywoodWaxMuseum", name: "Hollywood Wax Museum", description: "Pose with realistic wax figures of your favorite celebrities and pop culture icons.", adultPrice: 30, childPrice: 18, url: "https://www.hollywoodwaxentertainment.com" },
                { category: 'indoor-fun', id: "beyondTheLens", name: "Beyond the Lens!", description: "Explore interactive exhibits on pop culture, conspiracy theories, and tech-infused games.", adultPrice: 32, childPrice: 20, url: "https://www.beyondthelens.com" },
                { category: 'indoor-fun', id: "bransonDinosaurMuseum", name: "Branson Dinosaur Museum", description: "Walk among life-sized dinosaur replicas and learn about prehistoric life.", adultPrice: 15, childPrice: 10, url: "https://bransondinosaurmuseum.com" },
                { category: 'indoor-fun', id: "worldsLargestToyMuseum", name: "World's Largest Toy Museum", description: "Over a million toys from every generation in this massive nostalgic collection.", adultPrice: 24, childPrice: 16, url: "https://toymuseum.org" },

                // Rentals
                { category: 'rentals', id: "jetSkiRentals", name: "Jet Ski Rentals", description: "Ride the waves on Table Rock Lake with fast and fun Jet Ski rentals by the hour.", adultPrice: 100, childPrice: 100, url: null },
                { category: 'rentals', id: "boatAndTubes", name: "Boat and Tubes", description: "Rent a pontoon or ski boat for tubing, cruising, or relaxing with the whole crew.", adultPrice: 125, childPrice: 125, url: null },
            ];

            const interestOnly = [
                // Desserts & Treats (Interest Only)
                { category: 'desserts', id: "andysFrozenCustard", name: "Andy‚Äôs Frozen Custard", url: "https://www.eatandys.com" },
                { category: 'desserts', id: "cakesNCreams", name: "Cakes-n-Creams 50s Diner", url: "https://cakesncream.com" },
                { category: 'desserts', id: "kilwins", name: "Kilwins Chocolates & Ice Cream", url: "https://www.kilwins.com/stores/kilwins-branson" },
                { category: 'desserts', id: "parlorDoughnuts", name: "Parlor Doughnuts", url: "https://www.parlordoughnuts.com" },
                { category: 'desserts', id: "sugarLeafBakery", name: "Sugar Leaf Bakery & Caf√©", url: "https://www.sugarleaftreats.com" },
                { category: 'desserts', id: "creamAndSugar", name: "Cream & Sugar Dessert Bar (Hollister)", url: null },
                { category: 'desserts', id: "melsHardLuckDiner", name: "Mel‚Äôs Hard Luck Diner", url: "https://www.melshardluckdiner.com" },
                
                // Shopping & Free Time
                { category: 'shopping', id: "tangerOutlets", name: "Outlet Mall Shopping Trip (Tanger Outlets)", url: "https://www.tanger.com/branson" },
                { category: 'shopping', id: "bransonLanding", name: "Branson Landing", url: "https://www.bransonlanding.com" }
            ];

            // Helper function to format currency
            const formatCurrency = (value) => `$${value.toFixed(2)}`;

            // Helper function to render a single meal item
            const renderMeal = (meal) => {
                const mealItem = document.createElement('div');
                mealItem.className = "flex items-center space-x-2";
                mealItem.innerHTML = `
                    <input type="checkbox" id="${meal.id}" name="selectedMeals" value="${meal.id}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="${meal.id}" class="block text-sm font-medium text-gray-700">${meal.name}</label>
                `;
                mealsList.appendChild(mealItem);
            };

            // Helper function to render a single excursion card (number inputs)
            const renderExcursion = (excursion, container) => {
                const excursionCard = document.createElement('div');
                excursionCard.className = "activity bg-gray-50 p-4 rounded-lg shadow-inner";
                excursionCard.innerHTML = `
                    <h4 class="font-medium text-lg text-gray-900">
                        ${excursion.url ? `<a href="${excursion.url}" target="_blank" class="hover:underline">${excursion.name}</a>` : `<span>${excursion.name}</span>`}
                    </h4>
                    <p class="text-sm text-gray-500 mb-2">${excursion.description}</p>
                    <div class="flex items-center space-x-4">
                        <label class="flex-grow">
                            <span class="text-xs font-medium text-gray-700">Adults ($${excursion.adultPrice}):</span>
                            <div class="number-input-container">
                                <button type="button" class="decrement" data-target-id="${excursion.id}Adults">-</button>
                                <input type="number" id="${excursion.id}Adults" name="${excursion.id}Adults" min="0" value="0">
                                <button type="button" class="increment" data-target-id="${excursion.id}Adults">+</button>
                            </div>
                        </label>
                        <label class="flex-grow">
                            <span class="text-xs font-medium text-gray-700">Kids ($${excursion.childPrice}):</span>
                            <div class="number-input-container">
                                <button type="button" class="decrement" data-target-id="${excursion.id}Kids">-</button>
                                <input type="number" id="${excursion.id}Kids" name="${excursion.id}Kids" min="0" value="0">
                                <button type="button" class="increment" data-target-id="${excursion.id}Kids">+</button>
                            </div>
                        </label>
                    </div>
                `;
                container.appendChild(excursionCard);
            };
            
            // Helper function to render a single interest-only item (checkboxes)
            const renderInterestOnly = (item, container) => {
                const interestItem = document.createElement('div');
                interestItem.className = "flex items-start space-x-2 bg-gray-50 p-4 rounded-lg shadow-inner";
                interestItem.innerHTML = `
                    <input type="checkbox" id="${item.id}" name="selectedInterestOnly" value="${item.id}" class="mt-1 h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <div class="flex-grow">
                        <label for="${item.id}" class="block text-sm font-medium text-gray-700">
                            ${item.url ? `<a href="${item.url}" target="_blank" class="hover:underline">${item.name}</a>` : `<span>${item.name}</span>`}
                        </label>
                    </div>
                `;
                container.appendChild(interestItem);
            };

            // Function to handle increment/decrement buttons
            const handleButtonClick = (e) => {
                const button = e.target;
                if (button.tagName !== 'BUTTON') return;
                
                const targetId = button.getAttribute('data-target-id');
                const input = document.getElementById(targetId);
                let value = parseInt(input.value) || 0;

                if (button.classList.contains('increment')) {
                    value++;
                } else if (button.classList.contains('decrement') && value > 0) {
                    value--;
                }
                
                input.value = value;
                updateTotal();
            };

            // Function to render all meals and excursions
            const renderFormItems = () => {
                meals.forEach(renderMeal);
                
                excursions.forEach(excursion => {
                    if (excursion.category === 'adventure-thrill') {
                        renderExcursion(excursion, adventureThrillExcursionsContainer);
                    } else if (excursion.category === 'nature') {
                        renderExcursion(excursion, natureExcursionsContainer);
                    } else if (excursion.category === 'golf-recreation') {
                        renderExcursion(excursion, golfRecreationExcursionsContainer);
                    } else if (excursion.category === 'shows-entertainment') {
                        renderExcursion(excursion, showsEntertainmentExcursionsContainer);
                    } else if (excursion.category === 'indoor-fun') {
                        renderExcursion(excursion, indoorFunExcursionsContainer);
                    } else if (excursion.category === 'rentals') {
                        renderExcursion(excursion, rentalsExcursionsContainer);
                    }
                });

                interestOnly.forEach(item => {
                    if (item.category === 'desserts') {
                        renderInterestOnly(item, dessertsExcursionsContainer);
                    } else if (item.category === 'shopping') {
                        renderInterestOnly(item, shoppingExcursionsContainer);
                    }
                });
            };

            // Function to update the summary panel
            const updateTotal = () => {
                let totalCost = 0;
                let lodgingTotal = 0;
                let extraBedTotal = 0;
                let travelTotal = 0;
                let mealTotal = 0;
                let excursionTotal = 0;

                // Lodging cost
                if (lodgingCostSelect.value) {
                    lodgingTotal = parseFloat(lodgingCostSelect.value);
                }
                if (extraBedCheckbox.checked) {
                    extraBedTotal = 450;
                }

                // Travel cost
                const adultCount = parseInt(adultTravelersInput.value) || 0;
                const childCount = parseInt(childTravelersInput.value) || 0;
                if (travelModeSelect.value === 'flying') {
                    travelTotal = (adultCount + childCount) * 400;
                } else if (travelModeSelect.value === 'driving') {
                    const selectedOption = travelOriginSelect.options[travelOriginSelect.selectedIndex];
                    const distance = parseFloat(selectedOption.getAttribute('data-distance')) || 0;
                    // Round trip at 20 MPG, $3.00/gallon
                    travelTotal = (distance * 2 / 20) * 3.00;
                }

                // Meal cost
                const selectedMeals = document.querySelectorAll('#meals-list input[type="checkbox"]:checked');
                selectedMeals.forEach(checkbox => {
                    const meal = meals.find(m => m.id === checkbox.id);
                    if (meal) {
                        mealTotal += (adultCount * meal.cost.adult) + (childCount * meal.cost.child);
                    }
                });

                // Excursion cost
                excursions.forEach(excursion => {
                    const adults = parseInt(document.getElementById(`${excursion.id}Adults`).value) || 0;
                    const kids = parseInt(document.getElementById(`${excursion.id}Kids`).value) || 0;
                    excursionTotal += (adults * excursion.adultPrice) + (kids * excursion.childPrice);
                });

                // Calculate total
                totalCost = lodgingTotal + extraBedTotal + travelTotal + mealTotal + excursionTotal;

                // Update summary display
                summaryLodging.textContent = formatCurrency(lodgingTotal);
                summaryExtraBed.textContent = formatCurrency(extraBedTotal);
                summaryTravel.textContent = formatCurrency(travelTotal);
                summaryMeals.textContent = formatCurrency(mealTotal);
                summaryExcursions.textContent = formatCurrency(excursionTotal);
                summaryTotalCost.textContent = formatCurrency(totalCost);

                // Show the summary bar if any costs are calculated
                if (totalCost > 0 || lodgingTotal > 0 || extraBedTotal > 0 || travelTotal > 0 || mealTotal > 0 || excursionTotal > 0) {
                    costSummaryBar.style.display = 'block';
                } else {
                    costSummaryBar.style.display = 'none';
                }
            };

            // Event listeners for all input changes
            const addEventListeners = () => {
                reunionForm.addEventListener('change', (e) => {
                    // Toggle visibility of travel inputs
                    if (e.target.id === 'travelMode') {
                        if (e.target.value === 'driving') {
                            travelOriginGroup.classList.remove('hidden');
                            mileageDetailsGroup.classList.remove('hidden');
                            airportGroup.classList.add('hidden');
                            travelOriginSelect.setAttribute('required', 'true');
                        } else if (e.target.value === 'flying') {
                            travelOriginGroup.classList.add('hidden');
                            mileageDetailsGroup.classList.add('hidden');
                            airportGroup.classList.remove('hidden');
                            travelOriginSelect.removeAttribute('required');
                        } else {
                             travelOriginGroup.classList.add('hidden');
                            mileageDetailsGroup.classList.add('hidden');
                            airportGroup.classList.add('hidden');
                            travelOriginSelect.removeAttribute('required');
                        }
                    }
                    updateTotal();
                });
                
                reunionForm.addEventListener('input', (e) => {
                    // Update for number inputs
                    if (e.target.type === 'number') {
                        updateTotal();
                    }
                });

                // Add event listeners for the new +/- buttons
                reunionForm.addEventListener('click', handleButtonClick);
            };

            // Handle form submission
            reunionForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData();
                const selectedMeals = [];
                const selectedExcursions = [];
                const selectedInterestOnly = [];
                
                // Append standard form fields to FormData
                formData.append(googleFormEntryIds.familyName, document.getElementById('familyName').value);
                formData.append(googleFormEntryIds.attendees, document.getElementById('attendees').value);
                formData.append(googleFormEntryIds.lodgingCost, document.getElementById('lodgingCost').value);
                formData.append(googleFormEntryIds.extraBed, document.getElementById('extraBed').checked ? 'Yes' : 'No');
                formData.append(googleFormEntryIds.travelMode, document.getElementById('travelMode').value);
                formData.append(googleFormEntryIds.travelOrigin, document.getElementById('travelOrigin').value);
                formData.append(googleFormEntryIds.arrivalAirport, document.getElementById('arrivalAirport').value);
                formData.append(googleFormEntryIds.adultTravelers, document.getElementById('adultTravelers').value);
                formData.append(googleFormEntryIds.childTravelers, document.getElementById('childTravelers').value);

                // Collect selected meals
                document.querySelectorAll('#meals-list input[type="checkbox"]:checked').forEach(cb => {
                    selectedMeals.push(meals.find(m => m.id === cb.id).name);
                });
                formData.append(googleFormEntryIds.selectedMeals, selectedMeals.join(', ') || 'None');

                // Collect selected excursions (number inputs)
                excursions.forEach(excursion => {
                    const adults = parseInt(document.getElementById(`${excursion.id}Adults`).value) || 0;
                    const kids = parseInt(document.getElementById(`${excursion.id}Kids`).value) || 0;
                    if (adults > 0 || kids > 0) {
                        selectedExcursions.push(`${excursion.name} (Adults: ${adults}, Kids: ${kids})`);
                    }
                });

                // Collect selected interest-only items (checkboxes)
                document.querySelectorAll('#desserts-excursions input[type="checkbox"]:checked, #shopping-excursions input[type="checkbox"]:checked').forEach(cb => {
                    const item = interestOnly.find(i => i.id === cb.id);
                    if (item) {
                        selectedInterestOnly.push(item.name);
                    }
                });
                if (selectedInterestOnly.length > 0) {
                    selectedExcursions.push(`Interests: ${selectedInterestOnly.join(', ')}`);
                }

                formData.append(googleFormEntryIds.selectedExcursions, selectedExcursions.join('; ') || 'None');

                // Add mileage for driving
                if (travelModeSelect.value === 'driving') {
                    const selectedOption = travelOriginSelect.options[travelOriginSelect.selectedIndex];
                    const distance = parseFloat(selectedOption.getAttribute('data-distance')) || 0;
                    formData.append(googleFormEntryIds.mileage, distance);
                }

                // Add total cost
                const totalCostValue = summaryTotalCost.textContent;
                formData.append(googleFormEntryIds.totalCost, totalCostValue);

                try {
                    // Use a no-cors fetch call, as is common for Google Form submissions
                    const response = await fetch(googleFormUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                    
                    showConfirmationPage();
                    reunionForm.reset();
                    updateTotal();

                } catch (error) {
                    console.error('Submission error:', error);
                    showMessage('There was an error submitting your form. Please try again.', 'bg-red-100 text-red-800');
                }
            });

            function showConfirmationPage() {
                mainContent.classList.add('hidden');
                confirmationPage.classList.remove('hidden');
                setTimeout(() => {
                    confirmationCard.classList.remove('scale-95', 'opacity-0');
                    confirmationCard.classList.add('scale-100', 'opacity-100');
                }, 100);

                let countdown = 5;
                const countdownElement = document.getElementById('countdown');
                const interval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    if (countdown === 0) {
                        clearInterval(interval);
                        location.reload(); 
                    }
                }, 1000);
            }

            function showMessage(message, className) {
                messageBox.textContent = message;
                messageBox.className = `mt-4 p-3 rounded-md ${className}`;
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 5000);
            }

            // Initial render and setup
            renderFormItems();
            addEventListeners();
            updateTotal();
        });
    </script>
</body>
</html>
