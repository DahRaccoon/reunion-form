<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Reunion Form</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <style>
        /* Inter font for a clean, modern look */
        @import url('https://rsms.me/inter/inter.css');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        
        /* The main content container */
        .container {
            max-width: 1000px;
        }

        /* Floating summary bar */
        .cost-summary-bar {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4a5568; /* Darker gray background */
            color: #fff;
            padding: 1.5em;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            transition: all 0.3s ease-in-out;
            width: 300px;
            display: none; /* Initially hidden */
        }
        
        @media (max-width: 1024px) {
            .cost-summary-bar {
                position: static;
                width: 100%;
                margin-top: 2rem;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Confirmation Page Overlay (initially hidden) -->
    <div id="confirmationPage" class="fixed inset-0 bg-gray-50 flex items-center justify-center p-6 z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-2xl max-w-xl text-center transition-transform duration-500 transform scale-95 opacity-0" id="confirmationCard">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-green-500 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Form Submitted!</h1>
            <p class="text-gray-600 mb-4">Your family reunion form has been submitted successfully. Thank you!</p>
            <p class="text-sm font-semibold text-gray-500">Redirecting in <span id="countdown">5</span> seconds...</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div id="mainContent" class="py-12 px-6">
        <div class="container mx-auto flex flex-col lg:flex-row gap-8">
            
            <!-- Left Side: Form -->
            <div class="flex-grow">
                <!-- Header Section -->
                <div class="mb-8 text-center">
                    <h1 class="text-4xl font-bold mb-2">Table Rock Lake Family Reunion</h1>
                    <p class="text-lg text-gray-600">Please complete this form to help us plan!</p>
                </div>
                
                <form id="reunionForm" class="bg-white p-6 rounded-lg shadow-lg space-y-8">
                    
                    <!-- Family Information -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Family Information</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="familyName" class="block text-sm font-medium text-gray-700">Family Name</label>
                                <select id="familyName" name="familyName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select your family</option>
                                    <option value="Joe &amp; Kathy">Joe &amp; Kathy</option>
                                    <option value="Ryan">Ryan</option>
                                    <option value="Justin">Justin</option>
                                    <option value="Aubrey">Aubrey</option>
                                    <option value="Britney">Britney</option>
                                    <option value="Megan">Megan</option>
                                    <option value="Holly">Holly</option>
                                    <option value="Josh">Josh</option>
                                    <option value="Katie">Katie</option>
                                </select>
                            </div>
                            <div>
                                <label for="attendees" class="block text-sm font-medium text-gray-700">Who is attending? (Names & kids' ages)</label>
                                <textarea id="attendees" name="attendees" required rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Lodging Selection -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Lodging Selection</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="lodgingCost" class="block text-sm font-medium text-gray-700">What type of lodging will your family need?</label>
                                <select id="lodgingCost" name="lodgingCost" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select one</option>
                                    <option value="2129.63">Private bed only — $2,129.63</option>
                                    <option value="2555.56">Bed + space for kids — $2,555.56</option>
                                </select>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="extraBed" name="extraBed" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="extraBed" class="ml-2 block text-sm font-medium text-gray-700">Add an additional private bed — $450</label>
                            </div>
                        </div>
                    </section>

                    <!-- Travel Information -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Travel Information</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="travelMode" class="block text-sm font-medium text-gray-700">How are you traveling?</label>
                                <select id="travelMode" name="travelMode" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select</option>
                                    <option value="flying">Flying ($400/person)</option>
                                    <option value="driving">Driving (mileage-based)</option>
                                </select>
                            </div>
                            <!-- Updated Travel Origin dropdown with data-distance -->
                            <div id="travel-origin-group">
                                <label for="travelOrigin" class="block text-sm font-medium text-gray-700">Travel Origin</label>
                                <select id="travelOrigin" name="travelOrigin" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="">Select</option>
                                    <!-- Data-distance attributes for driving calculation -->
                                    <option value="Pocatello, ID" data-distance="1350">Pocatello, ID (~1350 miles)</option>
                                    <option value="Idaho Falls, ID" data-distance="1363">Idaho Falls, ID (~1363 miles)</option>
                                    <option value="Denver, CO" data-distance="803">Denver, CO (~803 miles)</option>
                                    <option value="Peachtree City, GA" data-distance="640">Peachtree City, GA (~640 miles)</option>
                                    <option value="Salt Lake City, UT" data-distance="1286">Salt Lake City, UT (~1286 miles)</option>
                                    <option value="Springfield, MO" data-distance="44">Springfield, MO (~44 miles)</option>
                                </select>
                            </div>
                            <!-- New input for mileage that shows for driving mode. This is now calculated based on origin. -->
                            <div id="mileage-details-group" class="hidden">
                                <p class="text-sm text-gray-600">Driving cost is calculated based on a round trip at 20 MPG and $3.00/gallon.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="adultTravelers" class="block text-sm font-medium text-gray-700">Adult Travelers</label>
                                    <input type="number" id="adultTravelers" name="adultTravelers" min="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                </div>
                                <div>
                                    <label for="childTravelers" class="block text-sm font-medium text-gray-700">Child Travelers</label>
                                    <input type="number" id="childTravelers" name="childTravelers" min="0" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                </div>
                            </div>
                            <div>
                                <label for="arrivalAirport" class="block text-sm font-medium text-gray-700">Arrival Airport</label>
                                <select id="arrivalAirport" name="arrivalAirport" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2">
                                    <option value="Springfield">Springfield</option>
                                    <option value="Bentonville">Bentonville</option>
                                    <option value="Tulsa">Tulsa</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- Meal Planning -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">🍽️ Meal Planning</h2>
                        <p class="text-gray-600 mb-4">Select the meals your family will attend. The cost is calculated based on a base rate of $8 per meal for each adult, and $4 per meal for each child in your family.</p>
                        <div id="meals-list" class="space-y-4">
                            <!-- Meals will be dynamically populated here -->
                        </div>
                    </section>

                    <!-- Excursions -->
                    <section>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Excursions</h2>
                        <p class="text-gray-600 mb-4">Select number of participants for each activity.</p>
                        <div id="excursions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Excursion cards will be dynamically populated here -->
                        </div>
                    </section>

                    <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-md transition-colors duration-200 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                        Submit Form
                    </button>
                    <div id="messageBox" class="mt-4 p-3 bg-indigo-100 text-indigo-800 rounded-md hidden"></div>
                </form>
            </div>
            
            <!-- Right Side: Cost Summary Bar -->
            <div class="cost-summary-bar lg:flex-shrink-0">
                <h3 class="text-xl font-bold mb-4">Your Summary</h3>
                <div id="detailedSummary" class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-200">Lodging Cost:</span>
                        <span id="summary-lodging" class="font-semibold">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-200">Extra Bed:</span>
                        <span id="summary-extra-bed" class="font-semibold">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-200">Travel Cost:</span>
                        <span id="summary-travel" class="font-semibold">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-200">Meal Cost:</span>
                        <span id="summary-meals" class="font-semibold">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-200">Excursion Cost:</span>
                        <span id="summary-excursions" class="font-semibold">$0.00</span>
                    </div>
                    <hr class="border-t border-gray-600 my-4">
                    <div class="flex justify-between items-center text-xl font-bold">
                        <span>Total:</span>
                        <span id="summary-total">$0.00</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reunionForm = document.getElementById('reunionForm');
            const mainContent = document.getElementById('mainContent');
            const confirmationPage = document.getElementById('confirmationPage');
            const confirmationCard = document.getElementById('confirmationCard');
            const messageBox = document.getElementById('messageBox');
            const costSummaryBar = document.querySelector('.cost-summary-bar');
            const mileageDetailsGroup = document.getElementById('mileage-details-group');
            const travelOriginSelect = document.getElementById('travelOrigin');
            
            // This is a placeholder URL and placeholder entry IDs.
            // YOU MUST create your own Google Form and replace this URL and the entry IDs below.
            // 1. Create a Google Form with fields matching the form's inputs.
            // 2. Go to the "Live" form and inspect the HTML.
            // 3. Find the `form action` URL and replace it below.
            // 4. Find the `name` attributes for each input and replace the `entry.xxxx` values below.
            const googleFormUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSc5jB0nhVWjpjHoViUiEJqX7BBheodhDNge6Pzb12yhTrnG3Q/formResponse';
            const googleFormEntryIds = {
                familyName: 'entry.123456789',
                attendees: 'entry.987654321',
                lodging: 'entry.112233445',
                extraBed: 'entry.556677889',
                travelMode: 'entry.998877665',
                travelOrigin: 'entry.123123123',
                arrivalAirport: 'entry.321321321',
                adultTravelers: 'entry.456456456',
                childTravelers: 'entry.654654654',
                mileage: 'entry.789789789', // New entry ID for mileage
                selectedMeals: 'entry.910111213',
                selectedExcursions: 'entry.141516171',
                totalCost: 'entry.181920212'
            };

            const excursions = [
                { id: "silverDollarCity", name: "Silver Dollar City", description: "A sprawling 1880s-style theme park with thrilling coasters, craft demonstrations, and live entertainment.", adultPrice: 89, childPrice: 79 },
                { id: "bransonMountainCoaster", name: "Branson Mountain Coaster", description: "Race through the Ozark hills on a self-controlled alpine coaster with dips and turns through the woods.", adultPrice: 20, childPrice: 20 },
                { id: "wolfeMountainZipline", name: "Wolfe Mountain Zipline", description: "Soar through tree canopies on scenic ziplines and explore the Snowflex tubing hill in all seasons.", adultPrice: 130, childPrice: 130 },
                { id: "fritzsAdventure", name: "Fritz’s Adventure", description: "Indoor adventure park with ropes courses, underground tunnels, climbing walls, and thrilling slides.", adultPrice: 35, childPrice: 35 },
                { id: "shepherdHillsAdventurePark", name: "Shepherd of the Hills Adventure Park", description: "Classic Branson destination offering ziplines, ropes courses, and a historic outdoor drama.", adultPrice: 30, childPrice: 30 },
                { id: "bigfootFunPark", name: "Bigfoot Fun Park", description: "Family fun with thrill rides, arcade games, and themed Bigfoot attractions including a gravity bomb.", adultPrice: 25, childPrice: 25 },
                { id: "xtremeRacingCenter", name: "Xtreme Racing Center", description: "Go full throttle on high-speed karts built for racing on a professionally designed outdoor track.", adultPrice: 40, childPrice: 40 },
                { id: "dogwoodCanyonNaturePark", name: "Dogwood Canyon Nature Park", description: "Explore lush trails, waterfalls, and wildlife on foot or by tram through this 10,000-acre private preserve.", adultPrice: 20, childPrice: 12 },
                { id: "topOfTheRockGolfCartTour", name: "Top of the Rock Golf Cart Tour", description: "Drive through stunning canyons and caves on a self-guided cart tour with panoramic Ozark views.", adultPrice: 50, childPrice: 35 },
                { id: "tableRockLakeBoating", name: "Table Rock Lake & Boating", description: "Enjoy a relaxing day swimming, fishing, or boating on the crystal-clear waters of Table Rock Lake.", adultPrice: 10, childPrice: 10 },
                { id: "ozarkMountainBiking", name: "Ozark Mountain Biking", description: "Tackle scenic mountain trails suited for all skill levels with bike rentals available on-site.", adultPrice: 20, childPrice: 20 },
                { id: "shepherdHillsPettingZoo", name: "Shepherd of the Hills Petting Zoo", description: "Feed goats, llamas, and other animals at this charming farm-themed experience for all ages.", adultPrice: 10, childPrice: 10 },
                { id: "henningConservationArea", name: "Henning Conservation Area", description: "Free scenic hiking trails through wooded Ozark hills and a historic fire tower overlook.", adultPrice: 0, childPrice: 0 },
                { id: "lakesideForestWildernessArea", name: "Lakeside Forest Wilderness Area", description: "Nature preserve with waterfalls, stone steps, and panoramic views of Lake Taneycomo.", adultPrice: 0, childPrice: 0 },
                { id: "bigCedarLodgeGolf", name: "Big Cedar Lodge Golf", description: "Play on world-class courses like Payne’s Valley, with breathtaking views and professional-grade design.", adultPrice: 300, childPrice: 300 },
                { id: "miniGolf", name: "Mini Golf", description: "Enjoy light-hearted competition at whimsical mini golf courses located across Branson.", adultPrice: 15, childPrice: 15 },
                { id: "bransonTracksArcade", name: "Branson Tracks & Arcade", description: "Fast-paced go-kart tracks, classic arcade games, and mini thrill rides for all ages.", adultPrice: 15, childPrice: 15 },
                { id: "familyBowlingNight", name: "Family Bowling Night", description: "Unwind with a family-friendly night at one of Branson’s retro or modern bowling alleys.", adultPrice: 25, childPrice: 25 },
                { id: "dollyPartonStampede", name: "Dolly Parton’s Stampede", description: "A four-course dinner and action-packed show with horseback stunts, music, and patriotic flair.", adultPrice: 65, childPrice: 35 },
                { id: "sightSoundTheatre", name: "Sight & Sound Theatre", description: "Epic Bible stories brought to life with Broadway-quality acting, animals, and massive sets.", adultPrice: 80, childPrice: 35 },
                { id: "showboatBransonBelle", name: "Showboat Branson Belle", description: "Cruise Table Rock Lake with a three-course dinner and live music, comedy, and variety shows.", adultPrice: 70, childPrice: 40 },
                { id: "imaxEntertainmentComplex", name: "IMAX Entertainment Complex", description: "Catch Hollywood films and live performances on one of the largest IMAX screens in the Midwest.", adultPrice: 20, childPrice: 20 },
                { id: "rezaEdgeOfIllusion", name: "Reza: Edge of Illusion", description: "Mind-blowing magic and illusion in one of Branson’s most popular modern shows.", adultPrice: 45, childPrice: 25 },
                { id: "clayCooperCountryExpress", name: "Clay Cooper’s Country Express", description: "High-energy country, rock and comedy from Branson's hometown entertainer.", adultPrice: 40, childPrice: 20 },
                { id: "presleysCountryJubilee", name: "The Presley’s Country Jubilee", description: "Classic Ozarks comedy and country music performed by Branson’s first family of entertainment.", adultPrice: 42, childPrice: 20 },
                { id: "hughesMusicShow", name: "The Hughes Music Show", description: "Big family production with music, dance, and light effects — performed by the Hughes Brothers.", adultPrice: 38, childPrice: 18 },
                { id: "texasTenors", name: "The Texas Tenors", description: "America’s Got Talent favorites blend country, classical, and pop in a polished vocal performance.", adultPrice: 50, childPrice: 25 },
                { id: "theHaygoods", name: "The Haygoods", description: "High-energy music show featuring sibling performers, pyrotechnics, and modern harmonies.", adultPrice: 47, childPrice: 25 },
                { id: "theDuttons", name: "The Duttons", description: "Family of musicians performing country, bluegrass, and pop hits.", adultPrice: 43, childPrice: 22 },
                { id: "wonderWorks", name: "WonderWorks", description: "An upside-down science museum with over 100 hands-on exhibits, laser tag, and rope courses.", adultPrice: 35, childPrice: 20 },
                { id: "aquariumAtTheBoardwalk", name: "Aquarium at the Boardwalk", description: "Dive into ocean life with touch tanks, a jellyfish room, and a 5D submarine ride.", adultPrice: 30, childPrice: 15 },
                { id: "titanicMuseum", name: "Titanic Museum", description: "Experience the tragedy and triumph of the Titanic through artifacts, replicas, and guided tours.", adultPrice: 35, childPrice: 20 },
                { id: "butterflyPalace", name: "Butterfly Palace", description: "Stroll through a lush tropical garden filled with thousands of free-flying butterflies.", adultPrice: 25, childPrice: 15 },
                { id: "ripleysBelieveItOrNot", name: "Ripley’s Believe It or Not!", description: "Weird, wacky, and unbelievable — explore oddities from around the globe in themed galleries.", adultPrice: 25, childPrice: 15 },
                { id: "retroArcadeNight", name: "Retro Arcade Night", description: "Step into the '80s with classic arcade cabinets and unlimited play passes.", adultPrice: 20, childPrice: 20 },
                { id: "hollywoodWaxMuseum", name: "Hollywood Wax Museum", description: "Pose with realistic wax figures of your favorite celebrities and pop culture icons.", adultPrice: 30, childPrice: 18 },
                { id: "beyondTheLens", name: "Beyond the Lens!", description: "Explore interactive exhibits on pop culture, conspiracy theories, and tech-infused games.", adultPrice: 32, childPrice: 20 },
                { id: "bransonDinosaurMuseum", name: "Branson Dinosaur Museum", description: "Walk among life-sized dinosaur replicas and learn about prehistoric life.", adultPrice: 15, childPrice: 10 },
                { id: "worldsLargestToyMuseum", name: "World's Largest Toy Museum", description: "Over a million toys from every generation in this massive nostalgic collection.", adultPrice: 24, childPrice: 16 },
                { id: "jetSkiRentals", name: "Jet Ski Rentals", description: "Ride the waves on Table Rock Lake with fast and fun Jet Ski rentals by the hour.", adultPrice: 100, childPrice: 100 },
                { id: "boatAndTubes", name: "Boat and Tubes", description: "Rent a pontoon or ski boat for tubing, cruising, or relaxing with the whole crew.", adultPrice: 125, childPrice: 125 }
            ];

            const meals = [
                { id: 'Sunday_Breakfast', name: 'Sunday - Breakfast'},
                { id: 'Sunday_Lunch', name: 'Sunday - Lunch'},
                { id: 'Sunday_Dinner', name: 'Sunday - Dinner: BBQ Night'},
                { id: 'Monday_Breakfast', name: 'Monday - Breakfast'},
                { id: 'Monday_Lunch', name: 'Monday - Lunch'},
                { id: 'Monday_Dinner', name: 'Monday - Dinner: Taco Bar'},
                { id: 'Tuesday_Breakfast', name: 'Tuesday - Breakfast'},
                { id: 'Tuesday_Lunch', name: 'Tuesday - Lunch'},
                { id: 'Tuesday_Dinner', name: 'Tuesday - Dinner: Burgers & Brats'},
                { id: 'Wednesday_Breakfast', name: 'Wednesday - Breakfast'},
                { id: 'Wednesday_Lunch', name: 'Wednesday - Lunch'},
                { id: 'Wednesday_Dinner', name: 'Wednesday - Dinner: Pasta Night'},
                { id: 'Thursday_Breakfast', name: 'Thursday - Breakfast'},
                { id: 'Thursday_Lunch', name: 'Thursday - Lunch'},
                { id: 'Thursday_Dinner', name: 'Thursday - Dinner: Pizza Night'},
                { id: 'Friday_Breakfast', name: 'Friday - Breakfast'},
                { id: 'Friday_Lunch', name: 'Friday - Lunch'},
                { id: 'Friday_Dinner', name: 'Friday - Dinner: Leftovers / Free Night'},
                { id: 'Saturday_Breakfast', name: 'Saturday - Breakfast'},
                { id: 'Saturday_Lunch', name: 'Saturday - Lunch'},
                { id: 'Saturday_Dinner', name: 'Saturday - Dinner: Sandwich Bar'}
            ];

            function renderExcursions() {
                const excursionsList = document.getElementById('excursions-list');
                excursionsList.innerHTML = excursions.map(excursion => `
                    <div class="bg-gray-100 p-4 rounded-lg shadow-md flex flex-col justify-between">
                        <div>
                            <h3 class="text-lg font-bold">${excursion.name}</h3>
                            <p class="text-sm text-gray-600">${excursion.description}</p>
                            <div class="mt-4 text-sm font-semibold text-gray-700">
                                Adults: $${excursion.adultPrice} | Children: $${excursion.childPrice}
                            </div>
                        </div>
                        <div class="mt-4 space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="font-medium">Adults</span>
                                <div class="flex items-center space-x-2">
                                    <button type="button" data-id="${excursion.id}" data-type="adult" data-action="decrement" class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 hover:bg-gray-400">-</button>
                                    <span id="${excursion.id}-adult-count" class="font-bold text-lg w-6 text-center">${excursion.adultCount || 0}</span>
                                    <button type="button" data-id="${excursion.id}" data-type="adult" data-action="increment" class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 hover:bg-gray-400">+</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="font-medium">Children</span>
                                <div class="flex items-center space-x-2">
                                    <button type="button" data-id="${excursion.id}" data-type="child" data-action="decrement" class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 hover:bg-gray-400">-</button>
                                    <span id="${excursion.id}-child-count" class="font-bold text-lg w-6 text-center">${excursion.childCount || 0}</span>
                                    <button type="button" data-id="${excursion.id}" data-type="child" data-action="increment" class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 hover:bg-gray-400">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function renderMeals() {
                const mealsList = document.getElementById('meals-list');
                const mealHTML = `
                    ${meals.map(meal => `
                        <div class="flex items-center">
                            <input type="checkbox" id="${meal.id}" name="${meal.id}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                            <label for="${meal.id}" class="ml-2 block text-sm font-medium text-gray-700">${meal.name}</label>
                        </div>
                    `).join('')}
                `;
                mealsList.innerHTML = mealHTML;
            }

            function updateSummary() {
                const lodgingCost = parseFloat(document.getElementById('lodgingCost').value) || 0;
                const extraBedCost = document.getElementById('extraBed').checked ? 450 : 0;
                const travelMode = document.getElementById('travelMode').value;
                const adultTravelers = parseInt(document.getElementById('adultTravelers').value) || 0;
                const childTravelers = parseInt(document.getElementById('childTravelers').value) || 0;
                
                let travelCost = 0;
                if (travelMode === 'flying') {
                    travelCost = (adultTravelers + childTravelers) * 400;
                    mileageDetailsGroup.classList.add('hidden');
                    travelOriginSelect.classList.remove('hidden');
                } else if (travelMode === 'driving') {
                    // New driving cost logic
                    const selectedOrigin = travelOriginSelect.options[travelOriginSelect.selectedIndex];
                    const distance = parseFloat(selectedOrigin.dataset.distance) || 0;
                    const mpg = 20;
                    const gasPrice = 3.00;
                    travelCost = (distance / mpg) * gasPrice * 2; // Round trip
                    mileageDetailsGroup.classList.remove('hidden');
                } else {
                    mileageDetailsGroup.classList.add('hidden');
                }
                
                let mealCost = 0;
                const perMealRate = 8 * (adultTravelers + 0.5 * childTravelers);
                document.querySelectorAll('#meals-list input[type="checkbox"]:checked').forEach(checkbox => {
                    mealCost += perMealRate;
                });

                let excursionCost = 0;
                excursions.forEach(excursion => {
                    excursionCost += ((excursion.adultCount || 0) * excursion.adultPrice) + ((excursion.childCount || 0) * excursion.childPrice);
                });

                const totalCost = lodgingCost + extraBedCost + travelCost + mealCost + excursionCost;

                document.getElementById('summary-lodging').textContent = `$${lodgingCost.toFixed(2)}`;
                document.getElementById('summary-extra-bed').textContent = `$${extraBedCost.toFixed(2)}`;
                document.getElementById('summary-travel').textContent = `$${travelCost.toFixed(2)}`;
                document.getElementById('summary-meals').textContent = `$${mealCost.toFixed(2)}`;
                document.getElementById('summary-excursions').textContent = `$${excursionCost.toFixed(2)}`;
                document.getElementById('summary-total').textContent = `$${totalCost.toFixed(2)}`;
                
                costSummaryBar.style.display = 'block';
            }

            function showMessage(message, className) {
                messageBox.textContent = message;
                messageBox.className = `mt-4 p-3 rounded-md ${className}`;
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 5000);
            }

            function showConfirmationPage() {
                mainContent.classList.add('hidden');
                confirmationPage.classList.remove('hidden');
                setTimeout(() => {
                    confirmationCard.classList.remove('scale-95', 'opacity-0');
                    confirmationCard.classList.add('scale-100', 'opacity-100');
                }, 100);

                let countdown = 5;
                const countdownElement = document.getElementById('countdown');
                const interval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    if (countdown === 0) {
                        clearInterval(interval);
                        location.reload(); 
                    }
                }, 1000);
            }

            // Initial render of excursions and meals
            renderExcursions();
            renderMeals();
            updateSummary();
            
            // Event listeners
            reunionForm.addEventListener('change', (e) => {
                if (e.target.id === 'travelMode' || e.target.id === 'travelOrigin') {
                    if (e.target.value === 'driving') {
                        mileageDetailsGroup.classList.remove('hidden');
                    } else {
                        mileageDetailsGroup.classList.add('hidden');
                    }
                }
                updateSummary();
            });

            reunionForm.addEventListener('click', (e) => {
                const target = e.target;
                if (target.matches('button[data-action]')) {
                    const id = target.dataset.id;
                    const type = target.dataset.type; // 'adult' or 'child'
                    const action = target.dataset.action; // 'increment' or 'decrement'
                    
                    const excursion = excursions.find(ex => ex.id === id);
                    if (excursion) {
                        const countKey = type === 'adult' ? 'adultCount' : 'childCount';
                        if (action === 'increment') {
                            excursion[countKey] = (excursion[countKey] || 0) + 1;
                        } else if (action === 'decrement' && (excursion[countKey] || 0) > 0) {
                            excursion[countKey]--;
                        }
                        document.getElementById(`${id}-${type}-count`).textContent = excursion[countKey];
                        updateSummary();
                    }
                }
            });

            reunionForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData();
                const formElements = reunionForm.elements;
                const selectedMeals = [];
                const selectedExcursions = [];

                // Collect all form data
                const familyName = formElements.familyName.value;
                const attendees = formElements.attendees.value;
                const lodgingCost = formElements.lodgingCost.value;
                const extraBed = formElements.extraBed.checked ? 'Yes' : 'No';
                const travelMode = formElements.travelMode.value;
                const travelOrigin = formElements.travelOrigin.value;
                const arrivalAirport = formElements.arrivalAirport.value;
                const adultTravelers = formElements.adultTravelers.value;
                const childTravelers = formElements.childTravelers.value;
                
                // Get mileage for driving cost submission
                let mileage = '';
                if (travelMode === 'driving') {
                    const selectedOrigin = travelOriginSelect.options[travelOriginSelect.selectedIndex];
                    mileage = selectedOrigin.dataset.distance;
                }
                
                // Collect selected meals
                document.querySelectorAll('#meals-list input[type="checkbox"]:checked').forEach(checkbox => {
                    const meal = meals.find(m => m.id === checkbox.id);
                    selectedMeals.push(meal.name);
                });
                
                // Collect selected excursions
                excursions.forEach(excursion => {
                    if ((excursion.adultCount || 0) > 0 || (excursion.childCount || 0) > 0) {
                        selectedExcursions.push(`${excursion.name} (Adults: ${excursion.adultCount || 0}, Children: ${excursion.childCount || 0})`);
                    }
                });

                // Get final total cost from the summary
                const totalCost = document.getElementById('summary-total').textContent;

                // Append data to form
                formData.append(googleFormEntryIds.familyName, familyName);
                formData.append(googleFormEntryIds.attendees, attendees);
                formData.append(googleFormEntryIds.lodging, `${lodgingCost} (Extra Bed: ${extraBed})`);
                formData.append(googleFormEntryIds.travelMode, travelMode);
                formData.append(googleFormEntryIds.travelOrigin, travelOrigin);
                formData.append(googleFormEntryIds.arrivalAirport, arrivalAirport);
                formData.append(googleFormEntryIds.adultTravelers, adultTravelers);
                formData.append(googleFormEntryIds.childTravelers, childTravelers);
                if (travelMode === 'driving') {
                    formData.append(googleFormEntryIds.mileage, mileage);
                }
                formData.append(googleFormEntryIds.selectedMeals, selectedMeals.join(', ') || 'None');
                formData.append(googleFormEntryIds.selectedExcursions, selectedExcursions.join('; ') || 'None');
                formData.append(googleFormEntryIds.totalCost, totalCost);

                try {
                    // Use a no-cors fetch call, as is common for Google Form submissions
                    const response = await fetch(googleFormUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                    
                    showConfirmationPage();
                    reunionForm.reset();

                } catch (error) {
                    console.error('Submission error:', error);
                    showMessage('There was an error submitting your form. Please try again.', 'bg-red-100 text-red-800');
                }
            });
        });
    </script>
</body>
</html>
